<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sidney Apparels - Operator Performance System v22</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.sheetjs.com/xlsx-0.19.3/package/dist/xlsx.full.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="loading-overlay">
        <div class="loading-spinner"></div>
        <div class="loading-text">LOADING SYSTEM DATA</div>
        <div style="margin-top: 25px; text-align: center; max-width: 500px; padding: 0 20px;">
            <h3 style="color: var(--text-primary); margin-bottom: 15px;">Sidney Apparels OPS v22.0</h3>
            <p style="color: var(--text-secondary); font-size: 0.95rem; line-height: 1.6;">
                Welcome to the Operator Performance System. Track operator efficiency, conduct time studies, 
                and analyze manufacturing performance.
            </p>
        </div>
    </div>

    <!-- Mobile Menu Toggle -->
    <div class="mobile-menu-toggle" id="mobileMenuToggle">
        <i class="fas fa-bars"></i>
    </div>

    <!-- Mobile Overlay -->
    <div class="sidebar-overlay" id="sidebarOverlay"></div>

    <!-- Sidebar Navigation -->
    <div class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <div class="logo">
                <div class="logo-icon">
                    <i class="fas fa-industry"></i>
                </div>
                <div class="logo-text">
                    <h1>SIDNEY APPARELS LLC</h1>
                    <h2>MANUFACTURING EXCELLENCE</h2>
                </div>
            </div>
        </div>
        
        <div class="sidebar-nav">
            <div class="nav-item active" data-tab="dashboard">
                <i class="fas fa-chart-line"></i>
                <span>Dashboard & Analysis</span>
            </div>
            <div class="nav-item" data-tab="operators">
                <i class="fas fa-users"></i>
                <span>Operators</span>
            </div>
            <div class="nav-item" data-tab="performance">
                <i class="fas fa-chart-bar"></i>
                <span>Performance Data</span>
            </div>
            <div class="nav-item" data-tab="time-study">
                <i class="fas fa-stopwatch"></i>
                <span>Time Study</span>
            </div>
            <div class="nav-item" data-tab="grading-criteria">
                <i class="fas fa-grip"></i>
                <span>Grading Criteria</span>
            </div>
        </div>
        
        <div class="sidebar-footer">
            <div class="current-time" id="sidebarCurrentTime">--:--:--</div>
            <div class="last-updated" id="sidebarLastUpdated">--/--/----</div>
        </div>
    </div>

    <!-- Main content area -->
    <div class="main-content-area">
        <!-- Simplified Header -->
        <header class="header">
            <div class="header-content">
                <div class="header-info">
                    <div class="info-item">
                        <i class="fas fa-database"></i>
                        <div class="info-item-content">
                            <div class="info-label">DATA VERSION</div>
                            <div class="info-value">v22.0</div>
                        </div>
                    </div>
                    <div class="info-item">
                        <i class="fas fa-sync-alt"></i>
                        <div class="info-item-content">
                            <div class="info-label">LAST SYNC</div>
                            <div class="info-value" id="headerLastSync">--:--:--</div>
                        </div>
                    </div>
                    <div class="info-item">
                        <i class="fas fa-users"></i>
                        <div class="info-item-content">
                            <div class="info-label">TOTAL OPERATORS</div>
                            <div class="info-value" id="headerTotalOps">0</div>
                        </div>
                    </div>
                    <div class="info-item">
                        <i class="fas fa-industry"></i>
                        <div class="info-item-content">
                            <div class="info-label">ACTIVE LINES</div>
                            <div class="info-value" id="headerActiveLines">0</div>
                        </div>
                    </div>
                    <!-- NEW: Time Studies Card -->
                    <div class="info-item">
                        <i class="fas fa-stopwatch"></i>
                        <div class="info-item-content">
                            <div class="info-label">TIME STUDIES</div>
                            <div class="info-value" id="headerTimeStudies">0</div>
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <!-- Dashboard Tab - UPDATED v22 -->
        <div id="dashboard" class="tab-content active">
            <div class="controls-panel">
                <div class="search-filter">
                    <div class="search-box">
                        <i class="fas fa-search"></i>
                        <input type="text" id="dashboardSearch" placeholder="Search across all data...">
                    </div>
                    <div class="filter-options">
                        <select id="dashboardLineFilter">
                            <option value="">All Lines</option>
                        </select>
                        <select id="dashboardDateRange">
                            <option value="today">Today</option>
                            <option value="week" selected>This Week</option>
                            <option value="month">This Month</option>
                            <option value="all">All Time</option>
                        </select>
                    </div>
                </div>
                <div class="action-buttons">
                    <button id="refreshDashboardBtn" class="btn btn-info">
                        <i class="fas fa-sync-alt"></i> Refresh Dashboard
                    </button>
                </div>
            </div>

            <!-- Dashboard Scrollable Container -->
            <div class="dashboard-scrollable">
                <!-- UPDATED v22: New Dashboard Grid with correct sequence -->
                <div class="dashboard-grid-v22">
                    <!-- Performance Metrics Card -->
                    <div class="dashboard-card">
                        <h3><i class="fas fa-chart-line"></i> Performance Metrics</h3>
                        <div class="metrics-grid">
                            <div class="metric-item efficiency">
                                <div class="value" id="dashboardAvgEfficiency">0%</div>
                                <div class="label">Avg Efficiency</div>
                            </div>
                            <div class="metric-item smv">
                                <div class="value" id="dashboardAvgSMV">0.00</div>
                                <div class="label">Avg SMV</div>
                            </div>
                            <div class="metric-item working-smv">
                                <div class="value" id="dashboardAvgWorkingSMV">0.00</div>
                                <div class="label">Avg Working SMV</div>
                            </div>
                            <div class="metric-item operations">
                                <div class="value" id="dashboardTotalOperations">0</div>
                                <div class="label">Total Operations</div>
                            </div>
                        </div>
                        <div style="margin-top: 20px; padding-top: 15px; border-top: 1px solid rgba(255, 255, 255, 0.1);">
                            <div style="display: flex; justify-content: space-between; font-size: 0.9rem;">
                                <span style="color: var(--text-secondary);">Active Lines:</span>
                                <span style="font-weight: 600; color: var(--primary-color);" id="dashboardActiveLines">0</span>
                            </div>
                        </div>
                    </div>

                    <!-- Skill Groups Container Card -->
                    <div class="dashboard-card skill-groups-container-card">
                        <h3><i class="fas fa-layer-group"></i> Skill Groups Distribution</h3>
                        <div class="skill-groups-grid">
                            <div class="skill-group-card group-a" id="dashboardGroupACard">
                                <div class="count" id="dashboardGroupACount">0</div>
                                <div class="label">Group A</div>
                                <div class="description">Grade A Operators</div>
                            </div>
                            <div class="skill-group-card group-b" id="dashboardGroupBCard">
                                <div class="count" id="dashboardGroupBCount">0</div>
                                <div class="label">Group B</div>
                                <div class="description">Grade B Operators</div>
                            </div>
                            <div class="skill-group-card group-c" id="dashboardGroupCCard">
                                <div class="count" id="dashboardGroupCCount">0</div>
                                <div class="label">Group C</div>
                                <div class="description">Grade C Operators</div>
                            </div>
                            <div class="skill-group-card group-d" id="dashboardGroupDCard">
                                <div class="count" id="dashboardGroupDCount">0</div>
                                <div class="label">Group D</div>
                                <div class="description">Grade D Operators</div>
                            </div>
                        </div>
                        <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid rgba(255, 255, 255, 0.1);">
                            <div style="color: var(--text-secondary); font-size: 0.85rem;">
                                <i class="fas fa-info-circle" style="color: var(--primary-color);"></i>
                                Click on any group to view operators
                            </div>
                        </div>
                    </div>

                    <!-- Total Operators Card -->
                    <div class="dashboard-card total-operators-card" id="dashboardTotalOperatorsCard">
                        <h3><i class="fas fa-users"></i> Total Operators</h3>
                        <div style="display: flex; align-items: center; gap: 20px;">
                            <div style="flex: 1;">
                                <div style="font-size: 3rem; font-weight: 700; margin-bottom: 10px; color: var(--primary-color);" id="dashboardTotalOperators">0</div>
                                <div style="color: var(--text-secondary); font-size: 0.9rem;">Active Operators</div>
                            </div>
                        </div>
                        <div class="line-selector">
                            <select id="dashboardLineSelect">
                                <option value="">All Lines</option>
                            </select>
                        </div>
                        <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid rgba(255, 255, 255, 0.1);">
                            <div style="color: var(--text-secondary); font-size: 0.85rem;">
                                <i class="fas fa-info-circle" style="color: var(--primary-color);"></i>
                                Select line to view operator count
                            </div>
                        </div>
                    </div>

                    <!-- Garment Standard SMV Card -->
                    <div class="garment-smv-card standard compact">
                        <h3><i class="fas fa-ruler"></i> Garment Standard SMV</h3>
                        <div class="garment-smv-selectors">
                            <select id="standardSMVLineSelect">
                                <option value="">Select Line</option>
                            </select>
                            <select id="standardSMVStyleSelect">
                                <option value="">Select Style</option>
                            </select>
                        </div>
                        <div class="garment-smv-value" id="totalStandardSMV">0.00</div>
                        <div class="garment-smv-label">Total Standard SMV (minutes)</div>
                    </div>

                    <!-- Garment Working SMV Card -->
                    <div class="garment-smv-card working compact">
                        <h3><i class="fas fa-ruler-combined"></i> Garment Working SMV</h3>
                        <div class="garment-smv-selectors">
                            <select id="workingSMVLineSelect">
                                <option value="">Select Line</option>
                            </select>
                            <select id="workingSMVStyleSelect">
                                <option value="">Select Style</option>
                            </select>
                        </div>
                        <div class="garment-smv-value" id="totalWorkingSMV">0.00</div>
                        <div class="garment-smv-label">Total Working SMV (minutes)</div>
                    </div>

                    <!-- Time Studies Count Card -->
                    <div class="dashboard-card time-studies-card">
                        <h3><i class="fas fa-stopwatch"></i> Time Studies Completed</h3>
                        <div style="display: flex; align-items: center; gap: 20px;">
                            <div style="flex: 1;">
                                <div style="font-size: 3rem; font-weight: 700; margin-bottom: 10px; color: var(--primary-color);" id="dashboardTimeStudiesCount">0</div>
                                <div style="color: var(--text-secondary); font-size: 0.9rem;">Total Time Studies</div>
                            </div>
                        </div>
                        <div class="line-selector">
                            <select id="timeStudiesLineSelect">
                                <option value="">All Lines</option>
                            </select>
                        </div>
                        <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid rgba(255, 255, 255, 0.1);">
                            <div style="color: var(--text-secondary); font-size: 0.85rem;">
                                <i class="fas fa-info-circle" style="color: var(--primary-color);"></i>
                                Filter by line to view time studies count
                            </div>
                        </div>
                    </div>

                    <!-- UPDATED v22: Machine Usage Statistics Card with text wrapping -->
                    <div class="dashboard-card machine-usage-card">
                        <h3><i class="fas fa-cogs"></i> Machine Usage Statistics</h3>
                        <div class="machine-usage-stats with-text-wrap" id="dashboardMachineUsage">
                            <div class="machine-usage-item">
                                <span class="machine-name">Loading...</span>
                                <span class="machine-count">0</span>
                            </div>
                        </div>
                        <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid rgba(255, 255, 255, 0.1);">
                            <div style="color: var(--text-secondary); font-size: 0.85rem;">
                                <i class="fas fa-info-circle" style="color: var(--primary-color);"></i>
                                Unique machines used by operators (count â‰¥ 1)
                            </div>
                        </div>
                    </div>

                    <!-- UPDATED v22: Bottleneck Operations Card with improved design -->
                    <div class="dashboard-card bottleneck-operations-card enhanced">
                        <div class="card-header-with-filters">
                            <h3><i class="fas fa-exclamation-triangle"></i> Bottleneck Operations</h3>
                            <div class="inline-filters">
                                <select id="bottleneckLineSelect" class="pretty-select">
                                    <option value="">All Lines</option>
                                </select>
                                <select id="bottleneckStyleSelect" class="pretty-select">
                                    <option value="">All Styles</option>
                                </select>
                            </div>
                        </div>
                        <div class="bottleneck-metrics">
                            <div class="metric-display">
                                <div class="metric-value" id="bottleneckCount">0</div>
                                <div class="metric-label">Total Bottleneck Ops</div>
                            </div>
                            <div class="metric-display">
                                <div class="metric-value" id="bottleneckAvgEff">0%</div>
                                <div class="metric-label">Avg Efficiency</div>
                            </div>
                        </div>
                        <div class="bottleneck-list" id="bottleneckList">
                            <div class="no-data">Select filters to view bottleneck operations</div>
                        </div>
                        <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid rgba(255, 255, 255, 0.1);">
                            <div style="color: var(--text-secondary); font-size: 0.85rem;">
                                <i class="fas fa-info-circle" style="color: var(--primary-color);"></i>
                                Operations slowing down production for selected line/style
                            </div>
                        </div>
                    </div>

                    <!-- UPDATED v22: High Priority Operations Card with improved design -->
                    <div class="dashboard-card high-priority-card enhanced">
                        <div class="card-header-with-filters">
                            <h3><i class="fas fa-exclamation-circle"></i> High Priority Operations</h3>
                            <div class="inline-filters">
                                <select id="priorityLineSelect" class="pretty-select">
                                    <option value="">All Lines</option>
                                </select>
                                <select id="priorityStyleSelect" class="pretty-select">
                                    <option value="">All Styles</option>
                                </select>
                            </div>
                        </div>
                        <div class="priority-metrics">
                            <div class="metric-display critical">
                                <div class="metric-value" id="criticalOperationsCount">0</div>
                                <div class="metric-label">Critical to Quality</div>
                            </div>
                            <div class="metric-display bottleneck">
                                <div class="metric-value" id="highPriorityBottleneckCount">0</div>
                                <div class="metric-label">Bottleneck Ops</div>
                            </div>
                            <div class="metric-display both">
                                <div class="metric-value" id="criticalBottleneckCount">0</div>
                                <div class="metric-label">Both Critical & Bottleneck</div>
                            </div>
                        </div>
                        <div class="priority-list" id="priorityList">
                            <div class="no-data">Select filters to view high priority operations</div>
                        </div>
                        <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid rgba(255, 255, 255, 0.1);">
                            <div style="color: var(--text-secondary); font-size: 0.85rem;">
                                <i class="fas fa-info-circle" style="color: var(--primary-color);"></i>
                                Operations requiring immediate attention
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Charts Section - UPDATED v22: Removed Weekly Performance Trend -->
                <div class="analysis-charts">
                    <div class="chart-card">
                        <h4><i class="fas fa-chart-pie"></i> Efficiency Distribution</h4>
                        <canvas id="efficiencyChart" height="250"></canvas>
                    </div>
                    <div class="chart-card">
                        <h4><i class="fas fa-industry"></i> Line Performance</h4>
                        <canvas id="linePerformanceChart" height="250"></canvas>
                    </div>
                    <div class="chart-card">
                        <h4><i class="fas fa-cogs"></i> Machine Performance</h4>
                        <canvas id="machinePerformanceChart" height="250"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <!-- Operators Tab - UPDATED v22: Removed the 4 cards -->
        <div id="operators" class="tab-content">
            <div class="controls-panel">
                <div class="search-filter">
                    <div class="search-box">
                        <i class="fas fa-search"></i>
                        <input type="text" id="searchInput" placeholder="Search by Operator ID or Name...">
                    </div>
                    <div class="filter-options">
                        <select id="skillFilter">
                            <option value="">Filter by Skill Level...</option>
                            <option value="Group A">Group A</option>
                            <option value="Group B">Group B</option>
                            <option value="Group C">Group C</option>
                            <option value="Group D">Group D</option>
                        </select>
                        <select id="lineFilter">
                            <option value="">Filter by Sew Line...</option>
                        </select>
                    </div>
                </div>
                <div class="action-buttons">
                    <button id="addOperatorBtn" class="btn btn-primary">
                        <i class="fas fa-user-plus"></i> Add Operator
                    </button>
                    <button id="editExistingDetailsBtn" class="btn btn-warning">
                        <i class="fas fa-edit"></i> Edit Existing Details
                    </button>
                    <button id="saveBtn" class="btn btn-success">
                        <i class="fas fa-save"></i> Save Changes
                    </button>
                    <button id="refreshBtn" class="btn btn-info">
                        <i class="fas fa-sync-alt"></i> Refresh
                    </button>
                </div>
            </div>

            <!-- Scrollable operators list -->
            <div class="table-container">
                <div class="table-header">
                    <h3><i class="fas fa-table"></i> OPERATORS MASTER LIST</h3>
                </div>
                <div class="data-table-wrapper">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>S.No.</th>
                                <th>OPERATOR ID</th>
                                <th>OPERATOR NAME</th>
                                <th>CURRENT SEW LINE</th>
                                <th>SKILL LEVEL</th>
                                <th>SKILL SCORE</th>
                                <th>ACTIONS</th>
                            </tr>
                        </thead>
                        <tbody id="operatorsBody">
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Performance Data Tab - UPDATED v22: Removed average efficiency and machine usage cards -->
        <div id="performance" class="tab-content">
            <!-- Statistics Dashboard with only Combined SMV Card -->
            <div class="stats-dashboard">
                <!-- Combined SMV Card -->
                <div class="stat-card combined-smv-card">
                    <div class="stat-header">
                        <div class="stat-icon">
                            <i class="fas fa-clock"></i>
                        </div>
                        <div class="stat-change">
                            <i class="fas fa-arrows-alt-v"></i>
                        </div>
                    </div>
                    <div class="stat-content">
                        <p>Standard vs Working SMV</p>
                        <div class="smv-values">
                            <div class="smv-value standard">
                                <div class="value" id="avgSMV">0.00</div>
                                <div class="label">Avg. Standard</div>
                            </div>
                            <div class="smv-value working">
                                <div class="value" id="avgWorkingSMV">0.00</div>
                                <div class="label">Avg. Working</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="controls-panel">
                <div class="search-filter">
                    <div class="search-box">
                        <i class="fas fa-search"></i>
                        <input type="text" id="searchPerformance" placeholder="Search by Operator ID, Name or Style...">
                    </div>
                    <div class="filter-options">
                        <select id="perfLineFilter">
                            <option value="">Filter by Line...</option>
                        </select>
                        <select id="dateFilter">
                            <option value="">Filter by Date...</option>
                            <option value="today">Today</option>
                            <option value="week">This Week</option>
                            <option value="month">This Month</option>
                        </select>
                    </div>
                </div>
                <div class="action-buttons">
                    <button id="addPerformanceBtn" class="btn btn-primary">
                        <i class="fas fa-plus-circle"></i> Add Performance Record
                    </button>
                    <button id="analyzeBtn" class="btn btn-info">
                        <i class="fas fa-chart-bar"></i> View Analysis
                    </button>
                </div>
            </div>

            <div class="table-container">
                <div class="table-header">
                    <h3><i class="fas fa-chart-line"></i> PERFORMANCE RECORDS</h3>
                </div>
                <div class="performance-table-wrapper">
                    <table class="performance-table">
                        <thead>
                            <tr>
                                <th>S.No.</th>
                                <th>Timestamp</th>
                                <th>Line No</th>
                                <th>Style No</th>
                                <th>Product Desc</th>
                                <th>Operator ID</th>
                                <th>Operator Name</th>
                                <th>Operation</th>
                                <th>Machine</th>
                                <th>Other Machines</th>
                                <th>Std SMV</th>
                                <th>Working SMV</th>
                                <th>Efficiency</th>
                                <th>Other Machine Efficiency</th>
                                <th>Operation Grade</th>
                                <!-- UPDATED v22: Combined CTQ and Bottleneck -->
                                <th>Critical to Quality</th>
                                <th>Bottleneck</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="performanceBody">
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Time Study Tab - UPDATED v22: Replaced radio buttons with dropdown for CTQ -->
        <div id="time-study" class="tab-content">
            <div class="stopwatch-container">
                <h3><i class="fas fa-stopwatch"></i> Time Study & SAM Calculation</h3>
                <p class="subtitle">Record lap times to calculate average time and efficiency (includes general allowances)</p>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="studyOperatorId">Operator ID *</label>
                        <select id="studyOperatorId" required>
                            <option value="">Select Operator</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="studyLineNo">Line No *</label>
                        <input type="text" id="studyLineNo" list="lineNoList" required placeholder="Enter or select line number">
                        <datalist id="lineNoList">
                            <!-- Options will be populated dynamically -->
                        </datalist>
                    </div>
                    <div class="form-group">
                        <label for="studyStyleNo">Style No (Running) *</label>
                        <input type="text" id="studyStyleNo" required placeholder="Enter style number">
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="studyProductDesc">Product Description *</label>
                        <input type="text" id="studyProductDesc" required placeholder="Enter product description">
                    </div>
                    <div class="form-group">
                        <label for="studyOperation">Operation Name *</label>
                        <input type="text" id="studyOperation" required placeholder="e.g., Hemming">
                    </div>
                    <div class="form-group">
                        <label for="studyMachine">Machine Name *</label>
                        <select id="studyMachine" required>
                            <optgroup label="KANSAI Family">
                                <option value="KANSAI">KANSAI</option>
                                <option value="FLATSEAMER">FLATSEAMER</option>
                                <option value="MULTI_NEEDLE">MULTI NEEDLE</option>
                            </optgroup>
                            <optgroup label="Single Needle Family">
                                <option value="SNLS">SNLS (Single Needle Lock Stitch)</option>
                                <option value="SNCS">SNCS (Single Needle Chain Stitch)</option>
                            </optgroup>
                            <optgroup label="Double Needle Family">
                                <option value="DNLS">DNLS (Double Needle Lock Stitch)</option>
                            </optgroup>
                            <optgroup label="Feed of Arm">
                                <option value="FOA">FOA (Feed Of Arm)</option>
                            </optgroup>
                            <optgroup label="Overlock Family">
                                <option value="OVERLOCK">OVERLOCK</option>
                            </optgroup>
                            <optgroup label="Flatlock Family">
                                <option value="FLATLOCK">FLATLOCK</option>
                            </optgroup>
                            <optgroup label="Button & Buttonhole">
                                <option value="BUTTON_ATTACH">BUTTON ATTACH</option>
                                <option value="BUTTONHOLE">BUTTONHOLE</option>
                            </optgroup>
                            <optgroup label="Bartack">
                                <option value="BARTACK">BARTACK</option>
                            </optgroup>
                            <optgroup label="Automation Machines">
                                <option value="AUTOMATIC_DRAWCORD">AUTOMATIC DRAWCORD</option>
                                <option value="AUTO_POCKET_HEM">AUTO POCKET HEM</option>
                                <option value="AUTO_POCKET_WELT">AUTO POCKET WELT</option>
                                <option value="AUTOMATIC_POCKET_SETTER">AUTOMATIC POCKET SETTER</option>
                                <option value="AUTOMATIC_BELT_LOOP_ATTACH">AUTOMATIC BELT LOOP ATTACH</option>
                                <option value="BLIND_LOOP_MAKING">BLIND LOOP MAKING</option>
                                <option value="AUTOMATIC_LABEL_ASSEMBLY">AUTOMATIC LABEL ASSEMBLY</option>
                                <option value="AUTOMATIC_LABEL_FIXING">AUTOMATIC LABEL FIXING</option>
                                <option value="HANG_TAG_STRING_INSERTION">HANG TAG STRING INSERTION</option>
                                <option value="AUTO_RIVET">AUTO RIVET</option>
                                <option value="SNAP_ATTACH">SNAP ATTACH</option>
                                <option value="AUTOMATIC_FLAT_BOTTOM_HEMMING">AUTOMATIC FLAT BOTTOM HEMMING</option>
                            </optgroup>
                            <optgroup label="Hemming Machines">
                                <option value="BLIND_HEM">BLIND HEM</option>
                                <option value="BOTTOM_HEM">BOTTOM HEM</option>
                            </optgroup>
                            <optgroup label="Special Machines">
                                <option value="POLO_SHIRT_PLACKET_AUTOMATION">POLO SHIRT PLACKET AUTOMATION</option>
                                <option value="PATTERN_SEWER">PATTERN SEWER</option>
                                <option value="MINI_PATTERN_SEAMER">MINI PATTERN SEAMER</option>
                                <option value="QUILTING">QUILTING</option>
                                <option value="ZIGZAG_STITCH">ZIGZAG STITCH</option>
                            </optgroup>
                            <optgroup label="Pressing & Heat">
                                <option value="HEAT_SEAL">HEAT SEAL / HEAT TRANSFER PRESS</option>
                                <option value="INSEAM_IRON">INSEAM IRON</option>
                                <option value="IRON_TABLE">IRON TABLE</option>
                            </optgroup>
                            <option value="Others">Others</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-row" id="customMachineRow" style="display: none;">
                    <div class="form-group">
                        <label for="customMachineName">Custom Machine Name *</label>
                        <input type="text" id="customMachineName" placeholder="Enter custom machine name">
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="standardSMV">Standard SMV (Minutes) *</label>
                        <input type="number" id="standardSMV" step="0.01" required placeholder="e.g., 0.45">
                    </div>
                    <div class="form-group">
                        <label for="operationGrade">Operation Complexity Grade</label>
                        <select id="operationGrade">
                            <option value="">Select Grade</option>
                            <option value="A">Grade A (Complex)</option>
                            <option value="B">Grade B (Moderate)</option>
                            <option value="C">Grade C (Simple)</option>
                            <option value="D">Grade D (Basic)</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="studyOtherMachines">Other Machines Used</label>
                        <div class="multi-select" id="otherMachinesSelect">
                            <div class="multi-select-display">
                                <span>Select machines...</span>
                                <i class="fas fa-chevron-down"></i>
                            </div>
                            <div class="multi-select-options" id="otherMachinesOptions">
                                <!-- Options will be populated dynamically from the same list as studyMachine -->
                            </div>
                            <div class="selected-options" id="selectedOtherMachines">
                            </div>
                        </div>
                    </div>
                </div>

                <!-- UPDATED v22: Replaced radio buttons with dropdown for Critical to Quality -->
                <h4 style="margin-top: 20px; margin-bottom: 15px; color: var(--text-primary);">
                    <i class="fas fa-exclamation-circle"></i> Critical to Quality & Bottleneck Settings
                </h4>
                
                <div class="form-row" style="background: rgba(255, 255, 255, 0.05); padding: 20px; border-radius: 12px; margin-bottom: 20px; border: 1px solid rgba(255, 255, 255, 0.1);">
                    <div class="form-group" style="flex: 1;">
                        <label for="ctqDropdown" style="font-weight: 600; color: var(--primary-color); margin-bottom: 10px;">Critical to Quality *</label>
                        <select id="ctqDropdown" style="width: 100%; padding: 12px 15px; border-radius: 8px; background: rgba(255, 255, 255, 0.1); border: 1px solid rgba(255, 255, 255, 0.2); color: var(--text-primary); font-size: 1rem;">
                            <option value="">Select CTQ Status</option>
                            <option value="critical">Critical to Quality</option>
                            <option value="not-critical">Not Critical</option>
                        </select>
                        <div style="font-size: 0.85rem; color: var(--text-secondary); margin-top: 8px;">
                            <i class="fas fa-info-circle"></i> Critical operations affect product quality directly
                        </div>
                    </div>
                    
                    <div class="form-group" style="margin-top: 20px;">
                        <label class="checkbox-label" style="background: rgba(255, 255, 255, 0.05); padding: 12px 20px; border-radius: 8px; display: block;">
                            <input type="checkbox" id="bottleneckCheckbox">
                            <span class="checkbox-custom"></span>
                            <span style="font-weight: 600; color: var(--warning-color);">Bottleneck Operation</span>
                            <div style="font-size: 0.85rem; color: var(--text-secondary); margin-top: 5px;">
                                Check if this operation slows down the production line
                            </div>
                        </label>
                    </div>
                </div>
                
                <!-- Allowance Information Display -->
                <div class="edit-info" id="allowanceInfo" style="margin-top: 15px;">
                    <h4 style="color: var(--primary-color); margin-bottom: 10px;"><i class="fas fa-calculator"></i> Allowance Breakdown</h4>
                    <div style="display: grid; grid-template-columns: 1fr; gap: 10px;">
                        <div>
                            <div style="font-size: 0.8rem; color: var(--text-secondary);">General Allowance</div>
                            <div style="font-weight: 600; color: var(--success-color);" id="generalAllowanceDisplay">16.67%</div>
                        </div>
                    </div>
                </div>
                
                <!-- Single Stopwatch with manual cycle input option -->
                <h4 style="margin-top: 20px; margin-bottom: 15px; color: var(--text-primary);">Cycle Time Measurement</h4>
                <div class="cycle-options">
                    <label>
                        <input type="radio" name="cycleCount" value="3" checked> 3 Cycles
                    </label>
                    <label>
                        <input type="radio" name="cycleCount" value="5"> 5 Cycles
                    </label>
                    <label>
                        <input type="radio" name="cycleCount" value="manual"> Manual Input
                    </label>
                </div>
                
                <div class="single-stopwatch">
                    <div class="stopwatch-display-container">
                        <div class="stopwatch-main" id="stopwatchDisplay">00:00:00.000</div>
                        <div class="stopwatch-lap" id="lapDisplay">Lap: 00:00:00.000</div>
                    </div>
                    
                    <div class="stopwatch-controls">
                        <button class="stopwatch-btn stopwatch-btn-start" id="startBtn">
                            <i class="fas fa-play"></i> Start
                        </button>
                        <button class="stopwatch-btn stopwatch-btn-pause" id="pauseBtn" disabled>
                            <i class="fas fa-pause"></i> Pause
                        </button>
                        <button class="stopwatch-btn stopwatch-btn-lap" id="lapBtn" disabled>
                            <i class="fas fa-stopwatch"></i> Lap
                        </button>
                        <button class="stopwatch-btn stopwatch-btn-lap" id="resetBtn">
                            <i class="fas fa-redo"></i> Reset
                        </button>
                    </div>
                    
                    <!-- Manual Cycle Time Input -->
                    <div class="manual-cycle-inputs" id="manualCycleInputs" style="display: none;">
                        <h4><i class="fas fa-keyboard"></i> Enter Cycle Times Manually</h4>
                        <div class="cycle-input-grid" id="manualCycleGrid">
                            <div class="cycle-input-group">
                                <label>Cycle 1 (seconds)</label>
                                <input type="number" class="manual-cycle-time" step="0.001" placeholder="e.g., 25.345">
                            </div>
                            <div class="cycle-input-group">
                                <label>Cycle 2 (seconds)</label>
                                <input type="number" class="manual-cycle-time" step="0.001" placeholder="e.g., 26.123">
                            </div>
                            <div class="cycle-input-group">
                                <label>Cycle 3 (seconds)</label>
                                <input type="number" class="manual-cycle-time" step="0.001" placeholder="e.g., 24.987">
                            </div>
                        </div>
                        <div class="action-buttons">
                            <button id="addManualCycleBtn" class="btn btn-secondary">
                                <i class="fas fa-plus"></i> Add More Cycles
                            </button>
                            <button id="calculateManualBtn" class="btn btn-primary">
                                <i class="fas fa-calculator"></i> Calculate
                            </button>
                        </div>
                    </div>
                    
                    <div class="laps-container">
                        <div class="laps-header">
                            <div>Cycle #</div>
                            <div>Time (sec)</div>
                        </div>
                        <div id="lapsList">
                        </div>
                    </div>
                </div>
                
                <!-- Results with general allowance -->
                <div class="cycle-results">
                    <h4 style="color: var(--primary-color);"><i class="fas fa-calculator"></i> Calculation Results (with general allowances)</h4>
                    <div class="results-grid">
                        <div class="result-item">
                            <div class="result-value" id="avgCycleTime">0.00</div>
                            <div class="result-label">Avg Cycle Time (sec)</div>
                        </div>
                        <div class="result-item">
                            <div class="result-value" id="totalCycleTime">0.00</div>
                            <div class="result-label">Total Time (sec)</div>
                        </div>
                        <div class="result-item">
                            <div class="result-value" id="workingSMVResult">0.00</div>
                            <div class="result-label">Working SMV (min)</div>
                        </div>
                        <div class="result-item">
                            <div class="result-value" id="efficiencyResult">0%</div>
                            <div class="result-label">Efficiency</div>
                        </div>
                    </div>
                    <div class="form-actions">
                        <button id="resetStopwatch" class="btn btn-danger">
                            <i class="fas fa-redo"></i> Reset All
                        </button>
                        <button id="savePerformanceData" class="btn btn-success">
                            <i class="fas fa-save"></i> Save Performance Record
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Grading Criteria Tab -->
        <div id="grading-criteria" class="tab-content">
            <div class="grading-criteria-content">
                <div class="criteria-section">
                    <h3><i class="fas fa-users"></i> Multi-Skills Classification</h3>
                    <div class="criteria-grid">
                        <div class="criteria-card">
                            <h4><i class="fas fa-star" style="color: var(--success-color);"></i> Grade A</h4>
                            <div class="criteria-details">
                                <div class="criteria-item">
                                    <div class="criteria-icon group-a">
                                        <i class="fas fa-check"></i>
                                    </div>
                                    <div class="criteria-text">
                                        <strong>3+ machine types</strong>
                                        <div class="description">With at least 1 machine at A grade, others at B or C</div>
                                    </div>
                                </div>
                                <div class="criteria-item">
                                    <div class="criteria-icon group-a">
                                        <i class="fas fa-user-check"></i>
                                    </div>
                                    <div class="criteria-text">
                                        <strong>Multi-skilled high performer</strong>
                                        <div class="description">Excellent versatility and efficiency across multiple operations</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="criteria-card">
                            <h4><i class="fas fa-star" style="color: var(--primary-color);"></i> Grade B</h4>
                            <div class="criteria-details">
                                <div class="criteria-item">
                                    <div class="criteria-icon group-b">
                                        <i class="fas fa-check"></i>
                                    </div>
                                    <div class="criteria-text">
                                        <strong>2+ machine types</strong>
                                        <div class="description">With at least 1 machine at B grade, the other at C</div>
                                    </div>
                                </div>
                                <div class="criteria-item">
                                    <div class="criteria-icon group-b">
                                        <i class="fas fa-user-check"></i>
                                    </div>
                                    <div class="criteria-text">
                                        <strong>Good performer with multiple skills</strong>
                                        <div class="description">Reliable performance across 2-3 operations</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="criteria-card">
                            <h4><i class="fas fa-star" style="color: var(--warning-color);"></i> Grade C</h4>
                            <div class="criteria-details">
                                <div class="criteria-item">
                                    <div class="criteria-icon group-c">
                                        <i class="fas fa-check"></i>
                                    </div>
                                    <div class="criteria-text">
                                        <strong>2 machine types</strong>
                                        <div class="description">Both machines at C grade</div>
                                    </div>
                                </div>
                                <div class="criteria-item">
                                    <div class="criteria-icon group-c">
                                        <i class="fas fa-user-check"></i>
                                    </div>
                                    <div class="criteria-text">
                                        <strong>Basic multi-skill operator</strong>
                                        <div class="description">Developing skills on 2 operations</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="criteria-card">
                            <h4><i class="fas fa-star" style="color: var(--accent-color);"></i> Grade D</h4>
                            <div class="criteria-details">
                                <div class="criteria-item">
                                    <div class="criteria-icon group-d">
                                        <i class="fas fa-check"></i>
                                    </div>
                                    <div class="criteria-text">
                                        <strong>1 machine type</strong>
                                        <div class="description">Only manual operations, but can handle 1 machine at D grade</div>
                                    </div>
                                </div>
                                <div class="criteria-item">
                                    <div class="criteria-icon group-d">
                                        <i class="fas fa-user-check"></i>
                                    </div>
                                    <div class="criteria-text">
                                        <strong>Developing skill set</strong>
                                        <div class="description">Entry-level operator learning basic operations</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Operation Complexity Criteria Section -->
                <div class="criteria-section">
                    <h3><i class="fas fa-layer-group"></i> Operation Complexity Grades</h3>
                    <div class="criteria-grid">
                        <div class="criteria-card">
                            <h4><i class="fas fa-award" style="color: #FF6B6B;"></i> Grade A</h4>
                            <div class="criteria-details">
                                <div class="criteria-item">
                                    <div class="criteria-icon" style="background-color: #FF6B6B;">
                                        <i class="fas fa-exclamation-circle"></i>
                                    </div>
                                    <div class="criteria-text">
                                        <strong>2-ply Curved</strong>
                                        <div class="description">Complex curved operations</div>
                                    </div>
                                </div>
                                <div class="criteria-item">
                                    <div class="criteria-icon" style="background-color: #FF6B6B;">
                                        <i class="fas fa-eye"></i>
                                    </div>
                                    <div class="criteria-text">
                                        <strong>Visible</strong>
                                        <div class="description">High visibility areas</div>
                                    </div>
                                </div>
                                <div class="criteria-item">
                                    <div class="criteria-icon" style="background-color: #FF6B6B;">
                                        <i class="fas fa-compress-alt"></i>
                                    </div>
                                    <div class="criteria-text">
                                        <strong>Constricted Area</strong>
                                        <div class="description">Limited accessibility</div>
                                    </div>
                                </div>
                                <div class="criteria-item">
                                    <div class="criteria-icon" style="background-color: #FF6B6B;">
                                        <i class="fas fa-industry"></i>
                                    </div>
                                    <div class="criteria-text">
                                        <strong>Examples</strong>
                                        <div class="description">Armhole, neckline</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="criteria-card">
                            <h4><i class="fas fa-award" style="color: #4ECDC4;"></i> Grade B</h4>
                            <div class="criteria-details">
                                <div class="criteria-item">
                                    <div class="criteria-icon" style="background-color: #4ECDC4;">
                                        <i class="fas fa-draw-polygon"></i>
                                    </div>
                                    <div class="criteria-text">
                                        <strong>2-ply Straight/Curve</strong>
                                        <div class="description">Moderate complexity</div>
                                    </div>
                                </div>
                                <div class="criteria-item">
                                    <div class="criteria-icon" style="background-color: #4ECDC4;">
                                        <i class="fas fa-eye-slash"></i>
                                    </div>
                                    <div class="criteria-text">
                                        <strong>Visible/Non-visible</strong>
                                        <div class="description">Mixed visibility</div>
                                    </div>
                                </div>
                                <div class="criteria-item">
                                    <div class="criteria-icon" style="background-color: #4ECDC4;">
                                        <i class="fas fa-compress"></i>
                                    </div>
                                    <div class="criteria-text">
                                        <strong>Semi-restricted</strong>
                                        <div class="description">Moderate accessibility</div>
                                    </div>
                                </div>
                                <div class="criteria-item">
                                    <div class="criteria-icon" style="background-color: #4ECDC4;">
                                        <i class="fas fa-industry"></i>
                                    </div>
                                    <div class="criteria-text">
                                        <strong>Examples</strong>
                                        <div class="description">Waist seam</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="criteria-card">
                            <h4><i class="fas fa-award" style="color: #FFD166;"></i> Grade C</h4>
                            <div class="criteria-details">
                                <div class="criteria-item">
                                    <div class="criteria-icon" style="background-color: #FFD166;">
                                        <i class="fas fa-ruler-combined"></i>
                                    </div>
                                    <div class="criteria-text">
                                        <strong>2-ply Straight</strong>
                                        <div class="description">Straight line operations</div>
                                    </div>
                                </div>
                                <div class="criteria-item">
                                    <div class="criteria-icon" style="background-color: #FFD166;">
                                        <i class="fas fa-eye-slash"></i>
                                    </div>
                                    <div class="criteria-text">
                                        <strong>Non-visible</strong>
                                        <div class="description">Hidden areas</div>
                                    </div>
                                </div>
                                <div class="criteria-item">
                                    <div class="criteria-icon" style="background-color: #FFD166;">
                                        <i class="fas fa-expand-alt"></i>
                                    </div>
                                    <div class="criteria-text">
                                        <strong>Open Area</strong>
                                        <div class="description">Good accessibility</div>
                                    </div>
                                </div>
                                <div class="criteria-item">
                                    <div class="criteria-icon" style="background-color: #FFD166;">
                                        <i class="fas fa-industry"></i>
                                    </div>
                                    <div class="criteria-text">
                                        <strong>Examples</strong>
                                        <div class="description">Inner seam</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="criteria-card">
                            <h4><i class="fas fa-award" style="color: #06D6A0;"></i> Grade D</h4>
                            <div class="criteria-details">
                                <div class="criteria-item">
                                    <div class="criteria-icon" style="background-color: #06D6A0;">
                                        <i class="fas fa-layer-group"></i>
                                    </div>
                                    <div class="criteria-text">
                                        <strong>1-ply Straight</strong>
                                        <div class="description">Simple single-layer operations</div>
                                    </div>
                                </div>
                                <div class="criteria-item">
                                    <div class="criteria-icon" style="background-color: #06D6A0;">
                                        <i class="fas fa-eye"></i>
                                    </div>
                                    <div class="criteria-text">
                                        <strong>Visible</strong>
                                        <div class="description">Easy to inspect</div>
                                    </div>
                                </div>
                                <div class="criteria-item">
                                    <div class="criteria-icon" style="background-color: #06D6A0;">
                                        <i class="fas fa-expand"></i>
                                    </div>
                                    <div class="criteria-text">
                                        <strong>Open Area</strong>
                                        <div class="description">Excellent accessibility</div>
                                    </div>
                                </div>
                                <div class="criteria-item">
                                    <div class="criteria-icon" style="background-color: #06D6A0;">
                                        <i class="fas fa-industry"></i>
                                    </div>
                                    <div class="criteria-text">
                                        <strong>Examples</strong>
                                        <div class="description">Hem, label attach</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="criteria-section">
                    <h3><i class="fas fa-chart-line"></i> Efficiency Classification</h3>
                    <div class="criteria-grid">
                        <div class="criteria-card">
                            <h4><i class="fas fa-arrow-up" style="color: var(--success-color);"></i> High Efficiency</h4>
                            <div class="criteria-details">
                                <div class="criteria-item">
                                    <div class="criteria-icon group-a">
                                        <i class="fas fa-chart-line"></i>
                                    </div>
                                    <div class="criteria-text">
                                        <strong>â‰¥85% Efficiency</strong>
                                        <div class="description">Exceeds expectations - Top performer</div>
                                    </div>
                                </div>
                                <div class="criteria-item">
                                    <div class="criteria-icon group-a">
                                        <i class="fas fa-trophy"></i>
                                    </div>
                                    <div class="criteria-text">
                                        <strong>Performance Rating</strong>
                                        <div class="description">Consistently exceeds targets</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="criteria-card">
                            <h4><i class="fas fa-equals" style="color: var(--primary-color);"></i> Medium Efficiency</h4>
                            <div class="criteria-details">
                                <div class="criteria-item">
                                    <div class="criteria-icon group-b">
                                        <i class="fas fa-chart-line"></i>
                                    </div>
                                    <div class="criteria-text">
                                        <strong>70-85% Efficiency</strong>
                                        <div class="description">Meets expectations - Reliable performer</div>
                                    </div>
                                </div>
                                <div class="criteria-item">
                                    <div class="criteria-icon group-b">
                                        <i class="fas fa-check-circle"></i>
                                    </div>
                                    <div class="criteria-text">
                                        <strong>Performance Rating</strong>
                                        <div class="description">Consistently meets targets</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="criteria-card">
                            <h4><i class="fas fa-arrow-down" style="color: var(--warning-color);"></i> Low Efficiency</h4>
                            <div class="criteria-details">
                                <div class="criteria-item">
                                    <div class="criteria-icon group-c">
                                        <i class="fas fa-chart-line"></i>
                                    </div>
                                    <div class="criteria-text">
                                        <strong>&lt;70% Efficiency</strong>
                                        <div class="description">Needs improvement - Requires training</div>
                                    </div>
                                </div>
                                <div class="criteria-item">
                                    <div class="criteria-icon group-c">
                                        <i class="fas fa-exclamation-triangle"></i>
                                    </div>
                                    <div class="criteria-text">
                                        <strong>Performance Rating</strong>
                                        <div class="description">Below target, needs attention</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <footer class="footer">
            <p>Â© 2025 Sidney Apparels LLC - Manufacturing Excellence</p>
            <div class="footer-credit">Made by Shantanu in HTML - Version 22.0</div>
            <div class="footer-stats">
                <div class="footer-stat">
                    <i class="fas fa-database"></i>
                    <span>Data Version: <strong id="dataVersion">22.0.0</strong></span>
                </div>
                <div class="footer-stat">
                    <i class="fas fa-sync-alt"></i>
                    <span>Last Sync: <strong id="lastSync">--:--:--</strong></span>
                </div>
                <div class="footer-stat">
                    <i class="fas fa-shield-alt"></i>
                    <span>Secure Connection: <strong>Active</strong></span>
                </div>
            </div>
        </footer>
    </div>

    <!-- Add Operator Modal -->
    <div id="addOperatorModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-user-plus"></i> Add New Operator</h3>
                <span class="close-modal" data-modal="addOperatorModal">&times;</span>
            </div>
            <div class="modal-body">
                <form id="addOperatorForm">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="newOperatorId">Operator ID *</label>
                            <input type="text" id="newOperatorId" required placeholder="e.g., OP-435264">
                        </div>
                        <div class="form-group">
                            <label for="newOperatorName">Operator Name *</label>
                            <input type="text" id="newOperatorName" required placeholder="Full name">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="newSewLine">Current Sew Line *</label>
                            <select id="newSewLine" required>
                                <option value="">Select Sew Line</option>
                                <option value="S-01">S-01</option>
                                <option value="S-01A">S-01A</option>
                                <option value="S-02">S-02</option>
                                <option value="S-03">S-03</option>
                                <option value="S-04">S-04</option>
                                <option value="S-05">S-05</option>
                                <option value="S-06">S-06</option>
                                <option value="S-07">S-07</option>
                                <option value="S-07A">S-07A</option>
                                <option value="S-08">S-08</option>
                                <option value="S-09">S-09</option>
                                <option value="S-10">S-10</option>
                                <option value="S-11">S-11</option>
                                <option value="S-12">S-12</option>
                                <option value="S-13">S-13</option>
                                <option value="S-14">S-14</option>
                                <option value="S-15">S-15</option>
                                <option value="S-16">S-16</option>
                                <option value="S-17">S-17</option>
                                <option value="S-18">S-18</option>
                                <option value="S-19">S-19</option>
                                <option value="S-20">S-20</option>
                                <option value="S-21">S-21</option>
                                <option value="S-22">S-22</option>
                                <option value="S-23">S-23</option>
                                <option value="S-24">S-24</option>
                                <option value="S-25">S-25</option>
                                <option value="S-26">S-26</option>
                                <option value="S-28">S-28</option>
                                <option value="S-29">S-29</option>
                                <option value="S-30">S-30</option>
                                <option value="S-31">S-31</option>
                                <option value="S-32">S-32</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="newSkillLevel">Initial Skill Level</label>
                            <select id="newSkillLevel">
                                <option value="">Select Level</option>
                                <option value="Group A">Group A</option>
                                <option value="Group B">Group B</option>
                                <option value="Group C">Group C</option>
                                <option value="Group D">Group D</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary" data-modal="addOperatorModal">Cancel</button>
                        <button type="submit" class="btn btn-primary">Add Operator</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Edit Skill Score Modal -->
    <div id="editCellModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-edit"></i> Edit Operator Details</h3>
                <span class="close-modal" data-modal="editCellModal">&times;</span>
            </div>
            <div class="modal-body">
                <div class="edit-info">
                    <p><strong>Operator ID:</strong> <span id="editOperatorId"></span></p>
                    <p><strong>Operator Name:</strong> <span id="editOperatorName"></span></p>
                </div>
                <form id="editCellForm">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="editSewLine">Current Sew Line</label>
                            <select id="editSewLine">
                                <option value="">Select Sew Line</option>
                                <option value="S-01">S-01</option>
                                <option value="S-01A">S-01A</option>
                                <option value="S-02">S-02</option>
                                <option value="S-03">S-03</option>
                                <option value="S-04">S-04</option>
                                <option value="S-05">S-05</option>
                                <option value="S-06">S-06</option>
                                <option value="S-07">S-07</option>
                                <option value="S-07A">S-07A</option>
                                <option value="S-08">S-08</option>
                                <option value="S-09">S-09</option>
                                <option value="S-10">S-10</option>
                                <option value="S-11">S-11</option>
                                <option value="S-12">S-12</option>
                                <option value="S-13">S-13</option>
                                <option value="S-14">S-14</option>
                                <option value="S-15">S-15</option>
                                <option value="S-16">S-16</option>
                                <option value="S-17">S-17</option>
                                <option value="S-18">S-18</option>
                                <option value="S-19">S-19</option>
                                <option value="S-20">S-20</option>
                                <option value="S-21">S-21</option>
                                <option value="S-22">S-22</option>
                                <option value="S-23">S-23</option>
                                <option value="S-24">S-24</option>
                                <option value="S-25">S-25</option>
                                <option value="S-26">S-26</option>
                                <option value="S-28">S-28</option>
                                <option value="S-29">S-29</option>
                                <option value="S-30">S-30</option>
                                <option value="S-31">S-31</option>
                                <option value="S-32">S-32</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="editSkillLevel">Skill Level</label>
                            <select id="editSkillLevel">
                                <option value="Group A">Group A</option>
                                <option value="Group B">Group B</option>
                                <option value="Group C">Group C</option>
                                <option value="Group D">Group D</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="editSkillScore">Skill Score (0.0 - 1.0)</label>
                        <input type="number" id="editSkillScore" min="0" max="1" step="0.05" required placeholder="e.g., 0.85">
                        <div class="score-slider">
                            <input type="range" id="scoreSlider" min="0" max="100" value="0">
                            <div class="slider-labels">
                                <span>0.0</span>
                                <span>0.5</span>
                                <span>1.0</span>
                            </div>
                        </div>
                    </div>
                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary" data-modal="editCellModal">Cancel</button>
                        <button type="submit" class="btn btn-primary">Save Changes</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- UPDATED v22: Edit Existing Details Modal with CTQ dropdown -->
    <div id="editExistingDetailsModal" class="modal">
        <div class="modal-content" style="max-width: 900px;">
            <div class="modal-header">
                <h3><i class="fas fa-edit"></i> Edit Existing Details</h3>
                <span class="close-modal" data-modal="editExistingDetailsModal">&times;</span>
            </div>
            <div class="modal-body">
                <div class="edit-info">
                    <p><strong>Operator:</strong> <span id="editExistingOperatorName">-</span> (<span id="editExistingOperatorId">-</span>)</p>
                    <p><strong>Current Grade:</strong> <span id="editExistingCurrentGrade">-</span></p>
                    <p><strong>Performance Records:</strong> <span id="editExistingRecordCount">0</span></p>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="editExistingOperatorSelect">Select Operator *</label>
                        <select id="editExistingOperatorSelect" required>
                            <option value="">Select Operator</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="editExistingRecordSelect">Select Performance Record *</label>
                        <select id="editExistingRecordSelect" required>
                            <option value="">Select Record</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-section" style="margin-top: 20px; padding-top: 20px; border-top: 1px solid rgba(255, 255, 255, 0.1);">
                    <h4 style="margin-bottom: 15px; color: var(--primary-color);"><i class="fas fa-cogs"></i> Edit Performance Record</h4>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="editExistingOperation">Operation Name</label>
                            <input type="text" id="editExistingOperation" placeholder="e.g., Hemming">
                        </div>
                        <div class="form-group">
                            <label for="editExistingMachine">Machine Name</label>
                            <select id="editExistingMachine">
                                <optgroup label="KANSAI Family">
                                    <option value="KANSAI">KANSAI</option>
                                    <option value="FLATSEAMER">FLATSEAMER</option>
                                    <option value="MULTI_NEEDLE">MULTI NEEDLE</option>
                                </optgroup>
                                <optgroup label="Single Needle Family">
                                    <option value="SNLS">SNLS (Single Needle Lock Stitch)</option>
                                    <option value="SNCS">SNCS (Single Needle Chain Stitch)</option>
                                </optgroup>
                                <optgroup label="Double Needle Family">
                                    <option value="DNLS">DNLS (Double Needle Lock Stitch)</option>
                                </optgroup>
                                <optgroup label="Feed of Arm">
                                    <option value="FOA">FOA (Feed Of Arm)</option>
                                </optgroup>
                                <optgroup label="Overlock Family">
                                    <option value="OVERLOCK">OVERLOCK</option>
                                </optgroup>
                                <optgroup label="Flatlock Family">
                                    <option value="FLATLOCK">FLATLOCK</option>
                                </optgroup>
                                <optgroup label="Button & Buttonhole">
                                    <option value="BUTTON_ATTACH">BUTTON ATTACH</option>
                                    <option value="BUTTONHOLE">BUTTONHOLE</option>
                                </optgroup>
                                <optgroup label="Bartack">
                                    <option value="BARTACK">BARTACK</option>
                                </optgroup>
                                <optgroup label="Automation Machines">
                                    <option value="AUTOMATIC_DRAWCORD">AUTOMATIC DRAWCORD</option>
                                    <option value="AUTO_POCKET_HEM">AUTO POCKET HEM</option>
                                    <option value="AUTO_POCKET_WELT">AUTO POCKET WELT</option>
                                    <option value="AUTOMATIC_POCKET_SETTER">AUTOMATIC POCKET SETTER</option>
                                    <option value="AUTOMATIC_BELT_LOOP_ATTACH">AUTOMATIC BELT LOOP ATTACH</option>
                                    <option value="BLIND_LOOP_MAKING">BLIND LOOP MAKING</option>
                                    <option value="AUTOMATIC_LABEL_ASSEMBLY">AUTOMATIC LABEL ASSEMBLY</option>
                                    <option value="AUTOMATIC_LABEL_FIXING">AUTOMATIC LABEL FIXING</option>
                                    <option value="HANG_TAG_STRING_INSERTION">HANG TAG STRING INSERTION</option>
                                    <option value="AUTO_RIVET">AUTO RIVET</option>
                                    <option value="SNAP_ATTACH">SNAP ATTACH</option>
                                    <option value="AUTOMATIC_FLAT_BOTTOM_HEMMING">AUTOMATIC FLAT BOTTOM HEMMING</option>
                                </optgroup>
                                <optgroup label="Hemming Machines">
                                    <option value="BLIND_HEM">BLIND HEM</option>
                                    <option value="BOTTOM_HEM">BOTTOM HEM</option>
                                </optgroup>
                                <optgroup label="Special Machines">
                                    <option value="POLO_SHIRT_PLACKET_AUTOMATION">POLO SHIRT PLACKET AUTOMATION</option>
                                    <option value="PATTERN_SEWER">PATTERN SEWER</option>
                                    <option value="MINI_PATTERN_SEAMER">MINI PATTERN SEAMER</option>
                                    <option value="QUILTING">QUILTING</option>
                                    <option value="ZIGZAG_STITCH">ZIGZAG STITCH</option>
                                </optgroup>
                                <optgroup label="Pressing & Heat">
                                    <option value="HEAT_SEAL">HEAT SEAL / HEAT TRANSFER PRESS</option>
                                    <option value="INSEAM_IRON">INSEAM IRON</option>
                                    <option value="IRON_TABLE">IRON TABLE</option>
                                </optgroup>
                                <option value="Others">Others</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="editExistingStdSMV">Standard SMV (min)</label>
                            <input type="number" id="editExistingStdSMV" step="0.01" placeholder="e.g., 0.45">
                        </div>
                        <div class="form-group">
                            <label for="editExistingWorkingSMV">Working SMV (min)</label>
                            <input type="number" id="editExistingWorkingSMV" step="0.01" placeholder="e.g., 0.52">
                        </div>
                        <div class="form-group">
                            <label for="editExistingEfficiency">Efficiency (%)</label>
                            <input type="number" id="editExistingEfficiency" min="0" max="200" step="0.1" placeholder="0-200%">
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="editExistingOperationGrade">Operation Complexity Grade</label>
                            <select id="editExistingOperationGrade">
                                <option value="">Select Grade</option>
                                <option value="A">Grade A</option>
                                <option value="B">Grade B</option>
                                <option value="C">Grade C</option>
                                <option value="D">Grade D</option>
                            </select>
                        </div>
                        <!-- UPDATED v22: CTQ dropdown instead of radio buttons -->
                        <div class="form-group">
                            <label for="editExistingCtqDropdown">Critical to Quality</label>
                            <select id="editExistingCtqDropdown" style="width: 100%; padding: 10px 15px; border-radius: 8px; background: rgba(255, 255, 255, 0.1); border: 1px solid rgba(255, 255, 255, 0.2); color: var(--text-primary);">
                                <option value="">Select CTQ Status</option>
                                <option value="critical">Critical to Quality</option>
                                <option value="not-critical">Not Critical</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Bottleneck</label>
                            <div class="checkbox-group" style="margin-top: 5px;">
                                <label class="checkbox-label">
                                    <input type="checkbox" id="editExistingBottleneck">
                                    <span class="checkbox-custom"></span>
                                    Bottleneck Operation
                                </label>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-row" id="editExistingCustomMachineRow" style="display: none;">
                        <div class="form-group">
                            <label for="editExistingCustomMachineName">Custom Machine Name</label>
                            <input type="text" id="editExistingCustomMachineName" placeholder="Enter custom machine name">
                        </div>
                    </div>
                </div>
                
                <!-- UPDATED v22: Other Machines Section -->
                <div class="form-section" style="margin-top: 20px; padding-top: 20px; border-top: 1px solid rgba(255, 255, 255, 0.1);">
                    <h4 style="margin-bottom: 15px; color: var(--success-color);"><i class="fas fa-plus-circle"></i> Other Machines & Efficiencies</h4>
                    <p style="color: var(--text-secondary); margin-bottom: 15px; font-size: 0.9rem;">
                        <i class="fas fa-info-circle"></i> These machines are loaded from all operator records. Changes here affect the operator's known machines.
                    </p>
                    
                    <div id="otherMachinesContainer">
                        <!-- Other machines will be added here dynamically -->
                        <div class="other-machine-item" style="display: flex; gap: 10px; margin-bottom: 10px; align-items: center;">
                            <div style="flex: 2;">
                                <select class="other-machine-select" style="width: 100%;">
                                    <option value="">Select Machine</option>
                                    <optgroup label="KANSAI Family">
                                        <option value="KANSAI">KANSAI</option>
                                        <option value="FLATSEAMER">FLATSEAMER</option>
                                        <option value="MULTI_NEEDLE">MULTI NEEDLE</option>
                                    </optgroup>
                                    <optgroup label="Single Needle Family">
                                        <option value="SNLS">SNLS (Single Needle Lock Stitch)</option>
                                        <option value="SNCS">SNCS (Single Needle Chain Stitch)</option>
                                    </optgroup>
                                    <optgroup label="Double Needle Family">
                                        <option value="DNLS">DNLS (Double Needle Lock Stitch)</option>
                                    </optgroup>
                                    <optgroup label="Feed of Arm">
                                        <option value="FOA">FOA (Feed Of Arm)</option>
                                    </optgroup>
                                    <optgroup label="Overlock Family">
                                        <option value="OVERLOCK">OVERLOCK</option>
                                    </optgroup>
                                    <optgroup label="Flatlock Family">
                                        <option value="FLATLOCK">FLATLOCK</option>
                                    </optgroup>
                                    <optgroup label="Button & Buttonhole">
                                        <option value="BUTTON_ATTACH">BUTTON ATTACH</option>
                                        <option value="BUTTONHOLE">BUTTONHOLE</option>
                                    </optgroup>
                                    <optgroup label="Bartack">
                                        <option value="BARTACK">BARTACK</option>
                                    </optgroup>
                                    <optgroup label="Automation Machines">
                                        <option value="AUTOMATIC_DRAWCORD">AUTOMATIC DRAWCORD</option>
                                        <option value="AUTO_POCKET_HEM">AUTO POCKET HEM</option>
                                        <option value="AUTO_POCKET_WELT">AUTO POCKET WELT</option>
                                        <option value="AUTOMATIC_POCKET_SETTER">AUTOMATIC POCKET SETTER</option>
                                        <option value="AUTOMATIC_BELT_LOOP_ATTACH">AUTOMATIC BELT LOOP ATTACH</option>
                                        <option value="BLIND_LOOP_MAKING">BLIND LOOP MAKING</option>
                                        <option value="AUTOMATIC_LABEL_ASSEMBLY">AUTOMATIC LABEL ASSEMBLY</option>
                                        <option value="AUTOMATIC_LABEL_FIXING">AUTOMATIC LABEL FIXING</option>
                                        <option value="HANG_TAG_STRING_INSERTION">HANG TAG STRING INSERTION</option>
                                        <option value="AUTO_RIVET">AUTO RIVET</option>
                                        <option value="SNAP_ATTACH">SNAP ATTACH</option>
                                        <option value="AUTOMATIC_FLAT_BOTTOM_HEMMING">AUTOMATIC FLAT BOTTOM HEMMING</option>
                                    </optgroup>
                                    <optgroup label="Hemming Machines">
                                        <option value="BLIND_HEM">BLIND HEM</option>
                                        <option value="BOTTOM_HEM">BOTTOM HEM</option>
                                    </optgroup>
                                    <optgroup label="Special Machines">
                                        <option value="POLO_SHIRT_PLACKET_AUTOMATION">POLO SHIRT PLACKET AUTOMATION</option>
                                        <option value="PATTERN_SEWER">PATTERN SEWER</option>
                                        <option value="MINI_PATTERN_SEAMER">MINI PATTERN SEAMER</option>
                                        <option value="QUILTING">QUILTING</option>
                                        <option value="ZIGZAG_STITCH">ZIGZAG STITCH</option>
                                    </optgroup>
                                    <optgroup label="Pressing & Heat">
                                        <option value="HEAT_SEAL">HEAT SEAL / HEAT TRANSFER PRESS</option>
                                        <option value="INSEAM_IRON">INSEAM IRON</option>
                                        <option value="IRON_TABLE">IRON TABLE</option>
                                    </optgroup>
                                    <option value="Others">Others</option>
                                </select>
                            </div>
                            <div style="flex: 1;">
                                <input type="number" class="other-machine-efficiency" min="0" max="200" step="0.1" placeholder="Efficiency %">
                            </div>
                            <div>
                                <button type="button" class="btn-icon remove-other-machine" title="Remove">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <button type="button" id="addOtherMachineBtn" class="btn btn-secondary" style="margin-top: 10px;">
                        <i class="fas fa-plus"></i> Add Another Machine
                    </button>
                    
                    <!-- Existing other machines -->
                    <div id="existingOtherMachines" style="margin-top: 20px;">
                        <h5 style="color: var(--text-secondary); margin-bottom: 10px;">
                            <i class="fas fa-database"></i> Operator's Known Machines (Loaded from ALL Records):
                        </h5>
                        <div id="existingOtherMachinesList" style="max-height: 150px; overflow-y: auto; background: rgba(255, 255, 255, 0.05); padding: 10px; border-radius: 8px;">
                            <div class="no-data">No other machines recorded for this operator</div>
                        </div>
                    </div>
                </div>
                
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" data-modal="editExistingDetailsModal">Cancel</button>
                    <button type="button" id="saveExistingDetailsBtn" class="btn btn-primary">Save All Changes</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Group Operators Modal -->
    <div id="groupOperatorsModal" class="modal group-operators-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-users"></i> <span id="groupModalTitle">Group A Operators</span></h3>
                <span class="close-modal" data-modal="groupOperatorsModal">&times;</span>
            </div>
            <div class="modal-body">
                <div class="edit-info">
                    <p><strong>Total Operators:</strong> <span id="groupOperatorCount">0</span></p>
                    <p><strong>Average Efficiency:</strong> <span id="groupAvgEfficiency">0%</span></p>
                    <p><strong>Skill Description:</strong> <span id="groupDescription"></span></p>
                </div>
                
                <div class="search-filter" style="margin-bottom: 15px;">
                    <div class="search-box">
                        <i class="fas fa-search"></i>
                        <input type="text" id="groupSearchInput" placeholder="Search within group...">
                    </div>
                    <div class="filter-options">
                        <select id="groupSortBy">
                            <option value="skillScore">Sort by: Skill Score</option>
                            <option value="efficiency">Sort by: Efficiency</option>
                            <option value="name">Sort by: Name</option>
                            <option value="line">Sort by: Line</option>
                        </select>
                    </div>
                </div>
                
                <div class="group-operators-list" id="groupOperatorsList" style="max-height: 400px; overflow-y: auto;">
                    <table style="width: 100%;">
                        <thead>
                            <tr>
                                <th>S.No.</th>
                                <th>Operator ID</th>
                                <th>Name</th>
                                <th>Line</th>
                                <th>Skill Score</th>
                            </tr>
                        </thead>
                        <tbody id="groupOperatorsTableBody">
                        </tbody>
                    </table>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" data-modal="groupOperatorsModal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Performance Modal -->
    <div id="addPerformanceModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-chart-line"></i> Add Performance Record</h3>
                <span class="close-modal" data-modal="addPerformanceModal">&times;</span>
            </div>
            <div class="modal-body">
                <form id="addPerformanceForm">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="perfOperatorId">Operator ID *</label>
                            <select id="perfOperatorId" required>
                                <option value="">Select Operator</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="perfLineNo">Line No *</label>
                            <input type="text" id="perfLineNo" required placeholder="Enter line number">
                        </div>
                        <div class="form-group">
                            <label for="perfStyleNo">Style No *</label>
                            <input type="text" id="perfStyleNo" required placeholder="Enter style number">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="perfProductDesc">Product Description *</label>
                            <input type="text" id="perfProductDesc" required placeholder="Enter product description">
                        </div>
                        <div class="form-group">
                            <label for="perfOperation">Operation Name *</label>
                            <input type="text" id="perfOperation" required placeholder="e.g., Hemming">
                        </div>
                        <div class="form-group">
                            <label for="perfMachine">Machine Name *</label>
                            <select id="perfMachine" required>
                                <optgroup label="KANSAI Family">
                                    <option value="KANSAI">KANSAI</option>
                                    <option value="FLATSEAMER">FLATSEAMER</option>
                                    <option value="MULTI_NEEDLE">MULTI NEEDLE</option>
                                </optgroup>
                                <optgroup label="Single Needle Family">
                                    <option value="SNLS">SNLS (Single Needle Lock Stitch)</option>
                                    <option value="SNCS">SNCS (Single Needle Chain Stitch)</option>
                                </optgroup>
                                <optgroup label="Double Needle Family">
                                    <option value="DNLS">DNLS (Double Needle Lock Stitch)</option>
                                </optgroup>
                                <optgroup label="Feed of Arm">
                                    <option value="FOA">FOA (Feed Of Arm)</option>
                                </optgroup>
                                <optgroup label="Overlock Family">
                                    <option value="OVERLOCK">OVERLOCK</option>
                                </optgroup>
                                <optgroup label="Flatlock Family">
                                    <option value="FLATLOCK">FLATLOCK</option>
                                </optgroup>
                                <optgroup label="Button & Buttonhole">
                                    <option value="BUTTON_ATTACH">BUTTON ATTACH</option>
                                    <option value="BUTTONHOLE">BUTTONHOLE</option>
                                </optgroup>
                                <optgroup label="Bartack">
                                    <option value="BARTACK">BARTACK</option>
                                </optgroup>
                                <optgroup label="Automation Machines">
                                    <option value="AUTOMATIC_DRAWCORD">AUTOMATIC DRAWCORD</option>
                                    <option value="AUTO_POCKET_HEM">AUTO POCKET HEM</option>
                                    <option value="AUTO_POCKET_WELT">AUTO POCKET WELT</option>
                                    <option value="AUTOMATIC_POCKET_SETTER">AUTOMATIC POCKET SETTER</option>
                                    <option value="AUTOMATIC_BELT_LOOP_ATTACH">AUTOMATIC BELT LOOP ATTACH</option>
                                    <option value="BLIND_LOOP_MAKING">BLIND LOOP MAKING</option>
                                    <option value="AUTOMATIC_LABEL_ASSEMBLY">AUTOMATIC LABEL ASSEMBLY</option>
                                    <option value="AUTOMATIC_LABEL_FIXING">AUTOMATIC LABEL FIXING</option>
                                    <option value="HANG_TAG_STRING_INSERTION">HANG TAG STRING INSERTION</option>
                                    <option value="AUTO_RIVET">AUTO RIVET</option>
                                    <option value="SNAP_ATTACH">SNAP ATTACH</option>
                                    <option value="AUTOMATIC_FLAT_BOTTOM_HEMMING">AUTOMATIC FLAT BOTTOM HEMMING</option>
                                </optgroup>
                                <optgroup label="Hemming Machines">
                                    <option value="BLIND_HEM">BLIND HEM</option>
                                    <option value="BOTTOM_HEM">BOTTOM HEM</option>
                                </optgroup>
                                <optgroup label="Special Machines">
                                    <option value="POLO_SHIRT_PLACKET_AUTOMATION">POLO SHIRT PLACKET AUTOMATION</option>
                                    <option value="PATTERN_SEWER">PATTERN SEWER</option>
                                    <option value="MINI_PATTERN_SEAMER">MINI PATTERN SEAMER</option>
                                    <option value="QUILTING">QUILTING</option>
                                    <option value="ZIGZAG_STITCH">ZIGZAG STITCH</option>
                                </optgroup>
                                <optgroup label="Pressing & Heat">
                                    <option value="HEAT_SEAL">HEAT SEAL / HEAT TRANSFER PRESS</option>
                                    <option value="INSEAM_IRON">INSEAM IRON</option>
                                    <option value="IRON_TABLE">IRON TABLE</option>
                                </optgroup>
                                <option value="Others">Others</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-row" id="perfCustomMachineRow" style="display: none;">
                        <div class="form-group">
                            <label for="perfCustomMachineName">Custom Machine Name *</label>
                            <input type="text" id="perfCustomMachineName" placeholder="Enter custom machine name">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="perfStdSMV">Standard SMV (min) *</label>
                            <input type="number" id="perfStdSMV" step="0.01" required placeholder="e.g., 0.45">
                        </div>
                        <div class="form-group">
                            <label for="perfWorkingSMV">Operator Working SMV (min) *</label>
                            <input type="number" id="perfWorkingSMV" step="0.01" required placeholder="e.g., 0.52">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Cycle Times (seconds)</label>
                            <div id="manualCycleTimes">
                            </div>
                            <button type="button" class="btn btn-secondary" id="addCycleTimeBtn">
                                <i class="fas fa-plus"></i> Add Cycle Time
                            </button>
                        </div>
                    </div>
                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary" data-modal="addPerformanceModal">Cancel</button>
                        <button type="submit" class="btn btn-primary">Save Performance Data</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Enhanced Working SMV Detail Modal -->
    <div id="cycleDetailModal" class="modal">
        <div class="modal-content" style="max-width: 700px;">
            <div class="modal-header">
                <h3><i class="fas fa-calculator"></i> Working SMV Breakdown</h3>
                <span class="close-modal" data-modal="cycleDetailModal">&times;</span>
            </div>
            <div class="modal-body">
                <div class="cycle-info">
                    <h4 style="margin-bottom: 15px;">Performance Details</h4>
                    <div class="breakdown-grid">
                        <div class="breakdown-item">
                            <div class="value" id="detailOperatorName">-</div>
                            <div class="label">Operator</div>
                        </div>
                        <div class="breakdown-item">
                            <div class="value" id="detailOperation">-</div>
                            <div class="label">Operation</div>
                        </div>
                        <div class="breakdown-item">
                            <div class="value" id="detailStdSMV">0.00</div>
                            <div class="label">Standard SMV (min)</div>
                        </div>
                        <div class="breakdown-item">
                            <div class="value" id="detailWorkingSMV">0.00</div>
                            <div class="label">Working SMV (min)</div>
                        </div>
                    </div>
                    
                    <div class="smv-breakdown">
                        <h4><i class="fas fa-calculator"></i> Calculation Formula</h4>
                        <div class="formula-display">
                            Working SMV = (Average Cycle Time in seconds Ã· 60) Ã— (1 + 16.67%)<br>
                            Where: General Allowance = 16.67%
                        </div>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 20px;">
                        <div>
                            <h4 style="color: var(--success-color); margin-bottom: 10px;">Efficiency</h4>
                            <div style="font-size: 2rem; font-weight: 700; color: var(--success-color);" id="detailEfficiency">0%</div>
                        </div>
                        <div>
                            <h4 style="color: var(--primary-color); margin-bottom: 10px;">Variance</h4>
                            <div style="font-size: 2rem; font-weight: 700; color: var(--primary-color);" id="detailVariance">0%</div>
                        </div>
                    </div>
                </div>
                
                <h4 style="margin: 20px 0 10px 0;">Cycle Times (seconds)</h4>
                <div class="cycle-times-list" id="cycleTimesList" style="max-height: 200px; overflow-y: auto;">
                </div>
            </div>
        </div>
    </div>

    <!-- UPDATED v22: Edit Performance Record Modal with CTQ dropdown -->
    <div id="editPerformanceModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-edit"></i> Edit Performance Record</h3>
                <span class="close-modal" data-modal="editPerformanceModal">&times;</span>
            </div>
            <div class="modal-body">
                <div class="edit-info">
                    <p><strong>Record ID:</strong> <span id="editRecordId"></span></p>
                    <p><strong>Operator:</strong> <span id="editRecordOperator"></span></p>
                </div>
                <form id="editPerformanceForm">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="editRecordStdSMV">Standard SMV (min)</label>
                            <input type="number" id="editRecordStdSMV" step="0.01" required>
                        </div>
                        <div class="form-group">
                            <label for="editRecordWorkingSMV">Working SMV (min)</label>
                            <input type="number" id="editRecordWorkingSMV" step="0.01" required>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="editRecordOperationGrade">Operation Complexity Grade</label>
                            <select id="editRecordOperationGrade">
                                <option value="">Select Grade</option>
                                <option value="A">Grade A</option>
                                <option value="B">Grade B</option>
                                <option value="C">Grade C</option>
                                <option value="D">Grade D</option>
                            </select>
                        </div>
                    </div>
                    <!-- UPDATED v22: CTQ dropdown and Bottleneck checkbox -->
                    <div class="form-row">
                        <div class="form-group">
                            <label for="editRecordCtqDropdown">Critical to Quality</label>
                            <select id="editRecordCtqDropdown" style="width: 100%; padding: 10px 15px; border-radius: 8px; background: rgba(255, 255, 255, 0.1); border: 1px solid rgba(255, 255, 255, 0.2); color: var(--text-primary);">
                                <option value="">Select CTQ Status</option>
                                <option value="critical">Critical to Quality</option>
                                <option value="not-critical">Not Critical</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Bottleneck Operation</label>
                            <div class="checkbox-group" style="margin-top: 5px;">
                                <label class="checkbox-label">
                                    <input type="checkbox" id="editRecordBottleneck">
                                    <span class="checkbox-custom"></span>
                                    Bottleneck
                                </label>
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="editRecordCycleTimes">Cycle Times (seconds, comma-separated)</label>
                        <input type="text" id="editRecordCycleTimes" placeholder="e.g., 25.3, 26.1, 24.8">
                        <small style="color: var(--text-secondary); display: block; margin-top: 5px;">
                            Enter cycle times separated by commas. Changing these will recalculate Working SMV with general allowance.
                        </small>
                    </div>
                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary" data-modal="editPerformanceModal">Cancel</button>
                        <button type="submit" class="btn btn-primary">Update Record</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Notification Toast -->
    <div id="notificationToast" class="toast">
        <div class="toast-content">
            <i class="fas fa-check-circle"></i>
            <span id="toastMessage">Operation completed successfully!</span>
        </div>
    </div>

    <script src="app.js" type="module"></script>
</body>
</html>
